{% extends "app/base.html" %}
{% load static %}
{% block title %}Home{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'css/demo.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
            <div id="layout">
        <div id="head">Demo</div>
        <div id="tail">

    <fieldset>
        <legend class="demo-head">Stage 1: Develop full understanding of your data</legend>
        <div class="steps">
            <div class='demo' >
                1. Upload your dataset or connect your data source
                <br><br>
                <img src="{% static 'images/demo/upload.png' %}" alt="">
            </div>
            <div class='demo' >
                2. (Understand your data) See best suited highly crafted visualizations(out of 10,000 visualizations), detailed breakdown of each column of your dataset.
                <br><br>
{#                <img src="{% static 'images/demo/spiral_optimized.gif' %}" style="width: 25vw;" alt="">#}
                <h2>Global Temperature Change (1850–2024)</h2>

<canvas id="spiralChart" width="600" height="600" style="display: block; margin: 20px auto;"></canvas>

                <br><br>

                <div class="graphs">
                    <img src="{% static 'images/demo/America+homeless+transport.png' %}" alt="">
                    <img src="{% static 'images/demo/donut.png' %}" alt="">
                    <img src="{% static 'images/demo/year.png' %}" alt="">
                    <img src="{% static 'images/demo/location.png' %}" alt="">
                </div>



            </div>


        </div>
        </fieldset>


    <fieldset>
        <legend class="demo-head">Stage 2: anomalies & patterns affecting your business</legend>
        <div class='demo' >
            3. Shows you detect every small anomaly or pattern within your dataset, and any relation of those anomaly with any pattern
            <br><br>
            <div class="pattern">
                <img src="{% static 'images/demo/net.png' %}" style="background: black" alt="">
                <img src="{% static 'images/demo/pattern.png' %}" alt="">
            </div>
        </div>


    </fieldset>



        <fieldset>
            <legend class="demo-head">Stage 3: Ask any business related concerns</legend>
            <div class='demo' >
                4. Ask questions about your dataset in natural language or speak
                <div class="pattern">
                    <img src="{% static 'images/demo/voice.jpg' %}" style="background: black; margin: 10px;" alt="">
                </div>
                <br><br>
            </div>
            <div class='demo' >
                5. In return, you will see a statistically accurate conclusion, and every related visualization backing up that conclusion.
                <div class="pattern">
                    <img src="{% static 'images/demo/pval.png' %}" style="background: black; margin: 10px;" alt="">
                </div>
            </div>


    </fieldset>

    <a href="{% url 'demo' %}">
        <button class="neomorphic-button">Demo - Coming Soon</button>
    </a>

            </div>
    </div>



{% endblock %}


{% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const temperatureData = [
                {% for year_data in temperature_data %}
                    [{{ year_data|join:", " }}],
                {% endfor %}
            ];
            const startYear = {{ start_year|default:1850 }};

            let yearIndex = 0;
            let monthIndex = 0;
            let labels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            let allData = [];

            const canvas = document.getElementById('spiralChart');
            canvas.width = 600;  // Adjust as needed
            canvas.height = 600; // Adjust as needed
            console.log("Canvas size set to:", canvas.width, canvas.height);

            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error("Canvas context not found!");
                return;
            }

            const centerYearPlugin = {
                id: 'centerYear',
                afterDatasetsDraw(chart) {
                    const { ctx, chartArea } = chart;
                    ctx.save();
                    ctx.font = 'bold 50px Arial';
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    const centerX = (chartArea.left + chartArea.right) / 2;
                    const centerY = (chartArea.top + chartArea.bottom) / 2;
                    const currentYear = startYear + yearIndex;
                    ctx.fillText(currentYear, centerX, centerY);
                    ctx.restore();
                }
            };

            const chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Global Temperature Anomaly (°C)",
                        data: [],
                        borderColor: 'rgba(230,212,16,0.6)',
                        backgroundColor: 'rgba(255,0,0,0)',
                        borderWidth: 2,
                        pointRadius: 2,

                    }]
                },
                options: {
                    animation: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true,
                                color: "gray",
                                lineWidth: 1,

                            },
                            grid: {
                                color: "rgba(255, 255, 255, 0.2)",
                                lineWidth: 1,
                                circular: true,
                                borderDash: [5, 5]
                            },
                            ticks: {
                                color: "white",
                                backdropColor: "rgba(0, 0, 0, 0)",
                                        font: {
                                    size: 30 // Increase label size (Jan, Feb, etc.)
                                },
                            },
                            pointLabels: {
                                font: {
                                    size: 30 // Increase label size (Jan, Feb, etc.)
                                },
                                color: "white" // Match your theme
                            },
                            suggestedMin: -0.5,
                            suggestedMax: 1.5
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                },
                plugins: [centerYearPlugin]
            });

            chart.resize();

            function animateSpiral() {
                if (yearIndex < temperatureData.length) {
                    if (monthIndex < 12) {
                        allData.push(temperatureData[yearIndex][monthIndex]);
                        chart.data.datasets[0].data = allData;
                        chart.update();
                        monthIndex++;
                    } else {
                        monthIndex = 0;
                        yearIndex++;
                    }
                } else {
                    yearIndex = 0;
                    monthIndex = 0;
                    allData = [];
                }
                setTimeout(animateSpiral, 1);
            }

            animateSpiral();
        });
    </script>
{% endblock %}


